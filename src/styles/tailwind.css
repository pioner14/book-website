@tailwind base;
@tailwind components;
@tailwind utilities;

/* Модульная шкала для типографического ритма */
:root {
  --space-xs: 0.25rem;
  /* 4px */
  --space-sm: 0.5rem;
  /* 8px */
  --space-md: 1rem;
  /* 16px */
  --space-lg: 1.5rem;
  /* 24px */
  --space-xl: 2rem;
  /* 32px */
  --space-2xl: 3rem;
  /* 48px */
  --space-3xl: 4rem;
  /* 64px */
  /* Цвета для навигации */
  --color-nav-green: #e9f5db;
  /* Очень мягкий зеленый */
  --color-nav-green-hover: #cfe1b9;
  --color-nav-green-text: #1b4332;

  --color-nav-yellow: #fefae0;
  /* Состаренная бумага */
  --color-nav-yellow-hover: #faedcd;
  --color-nav-yellow-text: #854d0e;
}

/* Улучшенная типографика для текста глав */
.prose {
  font-family: 'Merriweather', serif;
  /* Основной шрифт книги */
  font-size: clamp(1rem, 2.5vw, 1.125rem);
  /* Fluid размер шрифта */
  line-height: clamp(1.5, 3vw, 1.7);
  /* Fluid межстрочный интервал */
  max-width: clamp(45ch, 90vw, 70ch);
  /* Fluid ширина строки */
  margin: 0 auto;
}

/* Стили для заголовков с типографическим ритмом */
.prose h1 {
  font-family: 'Playfair Display', serif;
  font-weight: 700;
  margin-top: var(--space-3xl);
  margin-bottom: var(--space-xl);
  line-height: 1.2;
}

.prose h2 {
  font-family: 'Playfair Display', serif;
  font-weight: 700;
  margin-top: var(--space-2xl);
  margin-bottom: var(--space-lg);
  line-height: 1.3;
}

.prose h3 {
  font-family: 'Playfair Display', serif;
  font-weight: 700;
  margin-top: var(--space-xl);
  margin-bottom: var(--space-md);
  line-height: 1.4;
}

/* Стиль для заголовков глав внутри контента статей */
article.prose h1 {
  font-family: 'Pacifico', cursive;
  font-weight: 700;
}

/* Улучшения для длинных абзацев (Книжный стиль) */
.prose :where(p):not(:where([class~="not-prose"] *)) {
  hyphens: auto;
  -webkit-hyphens: auto;
  margin-top: 0 !important;
  margin-bottom: 0 !important;
  line-height: var(--reader-line-height, 1.6);
  orphans: 3;
  widows: 3;
  text-align: justify;
}

/* Красная строка для всех абзацев */
.prose :where(p):not(:where([class~="not-prose"] *)) {
  text-indent: 1.5em;
  hyphens: auto;
}

/* Первый абзац после заголовка или в начале статьи — без красной строки */
.prose h1+p,
.prose h2+p,
.prose h3+p,
.prose header+p,
.prose .not-prose+p,
.prose>p:first-of-type {
  text-indent: 0 !important;
}

/* Оформление диалогов */
.prose p {
  position: relative;
  transition: all 0.2s ease;
}

/* Специальный стиль для диалогов (отличаем по наличию тире в начале или специальной разметке) */
/* Так как мы не можем селектить по тексту, мы полагаемся на то, что это обычный параграф, 
   но можем добавить небольшой отступ сверху для групп диалогов или использовать hanging punctuation */

.prose :where(p):not(:where([class~="not-prose"] *)) {
  text-indent: 1.5em;
  /* Стандартный отступ «красная строка» */
  margin-bottom: 0.5em !important;
  /* Небольшой отступ между абзацами для читаемости в вебе */
}

/* Увеличиваем отступ и делаем его более «книжным» */
:root {
  --reader-indent: 2em;
}

.prose :where(p):not(:where([class~="not-prose"] *)) {
  text-indent: var(--reader-indent);
}

/* Если мы хотим «висячее» тире для диалогов, это сложнее без обертки, 
   но мы можем сделать общий стиль более просторным. */

/* Улучшения для контента статьи */
article {
  font-family: var(--reader-font-family, 'Merriweather', serif);
  font-feature-settings:
    "kern" 1,
    "liga" 1,
    "calt" 1,
    "onum" 1,
    "pnum" 1;
  font-kerning: normal;
  text-rendering: optimizeLegibility;
}

/* Дополнительный контейнер для настройки ширины текста */
.reader-container {
  max-width: var(--reader-max-width, 70ch);
  margin-left: auto;
  margin-right: auto;
  transition: max-width 0.3s ease;
}


/* Умные кавычки для русского языка */
.prose {
  quotes: '«' '»' '‹' '›';
}

/* Висячая пунктуация */
.prose :where(p):not(:where([class~="not-prose"] *)) {
  hanging-punctuation: first allow-end last allow-end;
}

/* Дополнительные стили для висячей пунктуации */
.prose p:first-child::first-letter,
.prose p:first-child::first-line {
  hanging-punctuation: first;
}

/* Обработка кавычек в начале строки */
.prose p:first-child::before {
  content: '';
  display: inline-block;
  width: 0.5em;
}

.prose p:first-child::after {
  content: '';
  display: inline-block;
  width: 0.5em;
}

/* Убедимся, что bg-paper имеет высокий приоритет */
.bg-paper {
  --tw-bg-opacity: 1 !important;
  background-color: rgb(247 241 227 / var(--tw-bg-opacity, 1)) !important;
}

.text-ink {
  --tw-text-opacity: 1 !important;
  color: rgb(45 55 72 / var(--tw-text-opacity, 1)) !important;
}

/* Темная тема через Tailwind селектор .dark */
.dark .bg-paper {
  background-color: rgb(17 24 39) !important;
}

.dark .text-ink {
  color: rgb(229 231 235) !important;
}

.dark .bg-parchment {
  background-color: rgb(31 41 55) !important;
}

.dark .text-secondary {
  color: rgb(156 163 175) !important;
}

.dark .bg-body-pattern {
  background-image: none !important;
}

.dark .prose h1,
.dark .prose h2,
.dark .prose h3 {
  color: rgb(243 244 246) !important;
}

/* Ручная темная тема - высокая специфичность */
html[data-theme="dark"] .bg-paper {
  background-color: rgb(17 24 39) !important;
}

html[data-theme="dark"] .text-ink {
  color: rgb(243 244 246) !important;
}

html[data-theme="dark"] .bg-parchment {
  background-color: rgb(31 41 55) !important;
}

html[data-theme="dark"] .text-secondary {
  color: rgb(209 213 219) !important;
}

html[data-theme="dark"] .bg-body-pattern {
  background-image: none !important;
}

html[data-theme="dark"] .prose h1,
html[data-theme="dark"] .prose h2,
html[data-theme="dark"] .prose h3 {
  color: rgb(255 255 255) !important;
}

/* Максимально специфичные правила для темной темы - в конце файла для приоритета */
html[data-theme="dark"] body {
  background-color: rgb(17 24 39) !important;
  color: rgb(243 244 246) !important;
}

html[data-theme="dark"] article,
html[data-theme="dark"] article *,
html[data-theme="dark"] article p,
html[data-theme="dark"] article li,
html[data-theme="dark"] article span,
html[data-theme="dark"] article div,
html[data-theme="dark"] article blockquote,
html[data-theme="dark"] article code,
html[data-theme="dark"] article pre,
html[data-theme="dark"] .prose,
html[data-theme="dark"] .prose *,
html[data-theme="dark"] .prose p,
html[data-theme="dark"] .prose li,
html[data-theme="dark"] .prose span,
html[data-theme="dark"] .prose div,
html[data-theme="dark"] .prose blockquote,
html[data-theme="dark"] .prose code,
html[data-theme="dark"] .prose pre {
  color: rgb(243 244 246) !important;
}

/* Светлая тема принудительно */
[data-theme="light"] .bg-paper {
  background-color: rgb(247 241 227) !important;
}

[data-theme="light"] .text-ink {
  color: rgb(45 55 72) !important;
}

[data-theme="light"] .bg-parchment {
  background-color: rgb(247 250 252) !important;
}

[data-theme="light"] .text-secondary {
  color: rgb(113 128 150) !important;
}

[data-theme="light"] .bg-body-pattern {
  background-image: url('data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAiIGhlaWdodD0iNDAiIHZpZXdCb3g9IjAgMCA0MCA0MCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48ZyBmaWxsPSJub25lIiBmaWxsLXJ1bGU9ImV2ZW5vZGQiPjxnIGZpbGw9IiNmYWZhZmEiIGZpbGwtb3BhY2l0eT0iMC4xIj48Y2lyY2xlIGN4PSIyMCIgY3k9IjIwIiByPSIxIi8+PGNpcmNsZSBjeD0iMjAiIGN5PSIyMCIgcj0iMiIvPjwvZz48L2c+PC9zdmc+') !important;
}

[data-theme="light"] .prose h1,
[data-theme="light"] .prose h2,
[data-theme="light"] .prose h3 {
  color: rgb(45 55 72) !important;
}