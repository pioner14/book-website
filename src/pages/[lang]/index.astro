---
import { getCollection } from "astro:content";
import Layout from "../../layouts/Layout.astro";

// Генерируем по одной странице для каждого языка: /ru, /ua, /fr
export function getStaticPaths() {
  return ["ru", "ua", "fr"].map((lang) => ({ params: { lang } }));
}

// Получаем текущий язык из URL
const { lang } = Astro.params;

// 1. Получаем все главы из коллекции
const allBookEntries = await getCollection("book");

// 2. Фильтруем их, оставляя только те, что относятся к текущему языку
// 3. Сортируем главы по номеру, указанному в frontmatter
const chapters = allBookEntries
  .filter((entry) => entry.slug.startsWith(lang + "/"))
  .sort((a, b) => a.data.order - b.data.order);

// Определяем заголовок в зависимости от языка
const titles = {
  ru: "Оглавление",
  ua: "Зміст",
  fr: "Table des matières",
};
const pageTitle = titles[lang as keyof typeof titles] || "Table of Contents";

// Определяем название книги в зависимости от языка
const bookTitles = {
  ru: "Рассказы маленькой собачки по имени Фиби",
  ua: "Оповідання маленької собачки на ім'я Фібі",
  fr: "Contes de la Petite Chienne Appelée Phœbé",
};
const bookTitle = bookTitles[lang as keyof typeof bookTitles] || bookTitles.ru;

// Вступление для каждого языка
const introductions = {
  ru: {
    title: "Кто такая Фиби?",
    paragraphs: [
      "Маленькая собачка по имени Фиби - светлошерстный Английский Кокер - спаниель с большими карими глазами, длинными кучерявыми ушками и мокреньким носиком, который хочется постоянно целовать.",
      "Она обожает вкусно поесть, долго спать, играться, плавать в океане, обниматься и путешествовать.",
      "Зато не любит чистить зубы, смотреть телевизор или телефон, оставаться одна и - хуже всего - не любит когда с ней не делятся едой.",
      "Если бы Фиби умела говорить, она бы рассказала вам свои истории, но так как она не умеет, я расскажу их вам за нее.",
    ],
  },
  ua: {
    title: "Познайомся з Фібі",
    paragraphs: [
      "Маленька собачка на ім’я Фібі — це світлошерстий англійський кокер-спанієль із великими добрими очима, кучерявими довгими вушками та маленьким носиком, який так і хочеться постійно цілувати.",
      "Фібі любить усе, що робить життя веселим і затишним: смачно поїсти, довгі сонні ранки, біганину на траві, ігри, купання в океані, обійматися та подорожувати.",
      "А от чого вона зовсім не любить — так це чистити зуби, дивитися телевізор, залишатися сама і, найголовніше, коли хтось їсть щось смачненьке без неї.",
      "Якби Фібі могла розмовляти, вона б із радістю поділилася своїми пригодами. Але поки що вона лише махає хвостиком, тому всі її історії розповім вам я.",
    ],
  },
  fr: {
    title: "Qui est Phibie ?",
    paragraphs: [
      "La petite chienne qui s’appelle Phibie est une cocker anglaise au pelage clair, avec de grands yeux marron, de longues oreilles bouclées et un petit nez tout humide qu’on a envie d’embrasser sans arrêt.",
      "Elle adore bien manger, faire de longues siestes, jouer, nager dans l’océan, faire des câlins et voyager.",
      "En revanche, elle n’aime pas se brosser les dents, regarder la télévision ou le téléphone, rester toute seule et — pire que tout — elle déteste quand on ne partage pas la nourriture avec elle.",
      "Si Phibie savait parler, elle vous raconterait elle-même toutes ses histoires, mais comme elle ne peut pas, je les raconterai pour elle.",
    ],
  },
};
const intro = introductions[lang as keyof typeof introductions];
---

<Layout title={pageTitle + " | " + bookTitle} currentSlug={`${lang}/`}>
  <div class="max-w-3xl mx-auto px-4">
    <h1 class="text-4xl font-body font-bold mb-8 tracking-wide text-center">
      {pageTitle}
    </h1>

    {/* Обложка */}
    <div id="cover" class="text-center mb-12">
      <img
        src="/cover.jpg"
        alt={bookTitle}
        class="mx-auto rounded-lg shadow-lg max-w-full h-auto"
      />
    </div>

    {
      intro && (
        <div
          id="introduction"
          class="prose prose-lg prose-ink mx-auto text-center mb-16 px-4"
        >
          <h2 class="text-3xl font-body font-bold mb-8 text-ink">
            {intro.title}
          </h2>
          {intro.paragraphs.map((p) => (
            <p class="mb-6 leading-relaxed">{p}</p>
          ))}
        </div>
      )
    }

    {
      chapters.length > 0 ? (
        <ol class="list-decimal list-inside space-y-4">
          {chapters.map((entry) => {
            const [_lang, slug] = entry.slug.split("/");
            return (
              <li class="text-xl">
                <a
                  href={`/${lang}/${slug}`}
                  class="font-sans hover:text-primary transition-colors block py-2"
                >
                  {entry.data.title}
                </a>
                {entry.data.description && (
                  <p class="text-sm text-secondary dark:text-gray-400 mt-1">
                    {entry.data.description}
                  </p>
                )}
              </li>
            );
          })}
        </ol>
      ) : (
        <p class="text-center text-lg text-ink/70 py-10">
          Для этого языка главы еще не добавлены.
        </p>
      )
    }
  </div>
</Layout>
