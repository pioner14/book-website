---
import { getCollection } from 'astro:content';
import Layout from '../../layouts/Layout.astro';
import { locales } from "astro:i18n";

// Генерируем по одной странице для каждого языка: /ru, /ua, /fr
export function getStaticPaths() {
  return locales.map((lang) => ({ params: { lang } }));
}

// Получаем текущий язык из URL
const { lang } = Astro.params;

// 1. Получаем все главы из коллекции
const allBookEntries = await getCollection('book');

// 2. Фильтруем их, оставляя только те, что относятся к текущему языку
// 3. Сортируем главы по номеру, указанному в frontmatter
const chapters = allBookEntries
  .filter(entry => entry.slug.startsWith(lang + '/'))
  .sort((a, b) => a.data.chapter_number - b.data.chapter_number);

// Определяем заголовок в зависимости от языка
const titles = {
  ru: "Оглавление",
  ua: "Зміст",
  fr: "Table des matières"
}
const pageTitle = titles[lang as keyof typeof titles] || "Table of Contents";
---

<Layout title={pageTitle + " | Название Книги"}>
  <div class="max-w-3xl mx-auto">
    <h1 class="text-4xl font-bold mb-8">{pageTitle}</h1>

    {chapters.length > 0 ? (
      <ol class="list-decimal list-inside space-y-4">
        {chapters.map(entry => {
          const [_lang, slug] = entry.slug.split('/');
          return (
            <li class="text-xl">
              <a href={`/${lang}/${slug}`} class="font-sans hover:text-primary transition-colors">
                {entry.data.title}
              </a>
              {entry.data.description && (
                <p class="text-sm text-ink/70 mt-1">{entry.data.description}</p>
              )}
            </li>
          )
        })}
      </ol>
    ) : (
      <p class="text-center text-lg text-ink/70 py-10">
        Для этого языка главы еще не добавлены.
      </p>
    )}
  </div>
</Layout>
